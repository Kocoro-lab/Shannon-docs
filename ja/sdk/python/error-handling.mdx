---
title: "ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°"
description: "Shannon Python SDKã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°"
---

<Note>
ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæ‹¡å¼µã•ã‚Œã¦ã„ã¾ã™ã€‚ã‚³ã‚¢ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ä»¥ä¸‹ã«ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚
</Note>

## æ¦‚è¦

Shannon Python SDKã¯ã€å …ç‰¢ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®åŒ…æ‹¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’æä¾›ã—ã¾ã™ã€‚ã™ã¹ã¦ã®SDKä¾‹å¤–ã¯`ShannonError`ã‹ã‚‰æ´¾ç”Ÿã—ã¦ã„ã¾ã™ã€‚

## ä¾‹å¤–éšå±¤

```python
ShannonError                    # åŸºæœ¬ä¾‹å¤–
â”œâ”€â”€ ConnectionError             # ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯/æ¥ç¶šã®å•é¡Œï¼ˆSDKç‰¹æœ‰ï¼‰
â”œâ”€â”€ AuthenticationError         # APIã‚­ãƒ¼/èªè¨¼ã®å•é¡Œ
â”œâ”€â”€ PermissionDeniedError       # ç¦æ­¢/èªå¯ã®å¤±æ•—
â”œâ”€â”€ ValidationError             # ç„¡åŠ¹ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
â”œâ”€â”€ RateLimitError              # ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå¤šã™ãã‚‹/åˆ¶é™ä¸­
â”œâ”€â”€ ServerError                 # ä¸Šæµã®5xxã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼
â”œâ”€â”€ TaskNotFoundError           # ã‚¿ã‚¹ã‚¯ãŒå­˜åœ¨ã—ãªã„
â”œâ”€â”€ TaskTimeoutError            # ã‚¿ã‚¹ã‚¯ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’è¶…ãˆãŸ
â”œâ”€â”€ TaskCancelledError          # ã‚¿ã‚¹ã‚¯ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸ
â”œâ”€â”€ SessionNotFoundError        # ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ãªã„
â”œâ”€â”€ SessionExpiredError         # ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒæœŸé™åˆ‡ã‚Œ
â”œâ”€â”€ TemplateError               # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ/ãƒ«ãƒ¼ãƒˆã®ã‚¨ãƒ©ãƒ¼
â””â”€â”€ TemplateNotFoundError       # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„
```

<Note>
äºˆç®—ã¨ã‚¿ã‚¹ã‚¯ã®å¤±æ•—å‡¦ç†: äºˆç®—è¶…éã¨ã‚¿ã‚¹ã‚¯ã®å¤±æ•—ã¯ä¾‹å¤–ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å¤±æ•—ã‚’ç¢ºèªã™ã‚‹ã«ã¯`status.status`ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ã¨ã‚³ã‚¹ãƒˆã®åˆè¨ˆã‚’ç¢ºèªã™ã‚‹ã«ã¯ã€`list_tasks()`ã‚’ä½¿ç”¨ã—ã€è¿”ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã®è¦ç´„ã‹ã‚‰`total_token_usage`ã‚’èª­ã¿å–ã‚Šã¾ã™ã€‚
</Note>

## åŸºæœ¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### Try-Catchãƒ‘ã‚¿ãƒ¼ãƒ³

```python
from shannon import (
    ShannonClient,
    ShannonError,
    AuthenticationError,
    ConnectionError,
    TaskTimeoutError,
    TaskStatusEnum,
)

client = ShannonClient(base_url="http://localhost:8080")

try:
    handle = client.submit_task(query="ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã™ã‚‹")
    status = client.wait(handle.task_id, timeout=120)

    if status.status == TaskStatusEnum.FAILED:
        print(f"ã‚¿ã‚¹ã‚¯ãŒå¤±æ•—ã—ã¾ã—ãŸ: {status.error_message}")
    else:
        print("çµæœ:", status.result)

except ConnectionError:
    print("Shannonã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ã§ã—ãŸ")
except AuthenticationError:
    print("ç„¡åŠ¹ãªAPIèªè¨¼æƒ…å ±")
except PermissionDeniedError:
    print("ç¦æ­¢: æ¨©é™ãŒä¸è¶³ã—ã¦ã„ã¾ã™")
except RateLimitError:
    print("ãƒ¬ãƒ¼ãƒˆåˆ¶é™: ã‚¹ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³ã™ã‚‹ã‹ã€ãƒãƒƒã‚¯ã‚ªãƒ•ã‚’è¿½åŠ ã—ã¦ãã ã•ã„")
except ServerError:
    print("ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ï¼ˆ5xxï¼‰: å¾Œã§ã‚‚ã†ä¸€åº¦è©¦ã—ã¦ãã ã•ã„")
except TaskTimeoutError:
    print("ã‚¿ã‚¹ã‚¯ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆåˆ¶é™ã‚’è¶…ãˆã¾ã—ãŸ")
except ShannonError as e:
    print(f"Shannonã‚¨ãƒ©ãƒ¼: {e}")
except Exception as e:
    print(f"äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼: {e}")
```

## ç‰¹å®šã®ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—

### æ¥ç¶šã‚¨ãƒ©ãƒ¼

ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŠã‚ˆã³æ¥ç¶šã®å•é¡Œã‚’å‡¦ç†ã—ã¾ã™:

```python
import time
from shannon import ShannonClient, ConnectionError

def connect_with_retry(max_retries=3):
    client = ShannonClient()

    for attempt in range(max_retries):
        try:
            # ç°¡å˜ãªã‚¿ã‚¹ã‚¯ã§æ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆ
            handle = client.submit_task(query="ping")
            return client

        except ConnectionError as e:
            if attempt < max_retries - 1:
                wait_time = 2 ** attempt  # æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•
                print(f"æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€‚{wait_time}så¾Œã«å†è©¦è¡Œã—ã¾ã™...")
                time.sleep(wait_time)
            else:
                print(f"{max_retries}å›ã®è©¦è¡Œå¾Œã«æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸ")
                raise
```

### ã‚³ã‚¹ãƒˆã¨å¤±æ•—ã®ç¢ºèª

ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‹ã‚‰å¤±æ•—ã‚’ç›£è¦–ã—ã€`list_tasks()`ã‚’ä»‹ã—ã¦ä½¿ç”¨é‡ã®åˆè¨ˆã‚’å–å¾—ã—ã¾ã™:

```python
from shannon import ShannonClient, TaskStatusEnum

client = ShannonClient()
handle = client.submit_task(query="ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã™ã‚‹")
status = client.wait(handle.task_id)

# å¤±æ•—ã®ç¢ºèªï¼ˆTaskStatusã¯åˆ—æŒ™å‹ã‚’è¿”ã™ï¼‰
if status.status == TaskStatusEnum.FAILED:
    print(f"ã‚¨ãƒ©ãƒ¼ã§å¤±æ•—ã—ã¾ã—ãŸ: {status.error_message}")

# ä½¿ç”¨é‡ã¨ã‚³ã‚¹ãƒˆã®åˆè¨ˆï¼ˆã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆã‹ã‚‰ï¼‰
tasks, _ = client.list_tasks(limit=50)
summary = next((t for t in tasks if t.task_id == handle.task_id), None)
usage = summary.total_token_usage if summary else None
if usage:
    print(f"tokens={usage.total_tokens} prompt={usage.prompt_tokens} completion={usage.completion_tokens} cost=${usage.cost_usd:.6f}")

# æ³¨æ„: TaskSummaryã®statusã¯æ–‡å­—åˆ—ã§ã™
if summary and summary.status == "FAILED":
    print("è¦ç´„ã¯å¤±æ•—ã‚’ç¤ºã—ã¦ã„ã¾ã™")
```

### ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼

é•·æ™‚é–“å®Ÿè¡Œã•ã‚Œã‚‹æ“ä½œã‚’å‡¦ç†ã—ã¾ã™:

```python
import asyncio
from shannon import AsyncShannonClient, TaskTimeoutError

async def with_timeout_handling():
    async with AsyncShannonClient() as client:
        try:
            # asyncio.TimeoutErrorã¯wait_forãƒ©ãƒƒãƒ‘ãƒ¼ã‹ã‚‰ç™ºç”Ÿã—ã¾ã™ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ï¼‰
            handle = await asyncio.wait_for(
                client.submit_task(query="è¤‡é›‘ãªåˆ†æ"),
                timeout=10.0,
            )
            # TaskTimeoutErrorã¯ã‚¿ã‚¹ã‚¯ãŒè‡ªèº«ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’è¶…ãˆãŸå ´åˆã«Shannonã‹ã‚‰ç™ºç”Ÿã—ã¾ã™
            result = await asyncio.wait_for(
                client.wait(handle.task_id),
                timeout=60.0,
            )
            return result

        except asyncio.TimeoutError:
            print("æ“ä½œãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®asyncioã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰")
            return None
        except TaskTimeoutError:
            print("ã‚¿ã‚¹ã‚¯ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸï¼ˆShannonãŒå ±å‘Šã—ãŸã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰")
            return None
```

### ãƒ¬ãƒ¼ãƒˆåˆ¶é™

APIã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’é©åˆ‡ã«å‡¦ç†ã—ã¾ã™ï¼š

```python
from shannon import ShannonClient, ConnectionError
import time

def handle_rate_limits(queries):
    client = ShannonClient()
    results = []

    for query in queries:
        backoff = 1
        while True:
            try:
                handle = client.submit_task(query=query)
                result = client.wait(handle.task_id)
                results.append(result)
                break  # æˆåŠŸã€æ¬¡ã¸é€²ã‚€
            except ConnectionError:
                # ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã¾ãŸã¯ä¸€æ™‚çš„ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼
                print(f"ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã¾ãŸã¯ä¸€æ™‚çš„ãªã‚¨ãƒ©ãƒ¼ã€{backoff}så¾Œã«å†è©¦è¡Œã—ã¾ã™...")
                time.sleep(backoff)
                backoff = min(backoff * 2, 30)

    return results
```

<Note>
ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®æ˜ç¢ºã•ï¼š`from shannon import ConnectionError`ã¯SDKã®ä¾‹å¤–ã‚’æŒ‡ã—ã¾ã™ï¼ˆPythonã®çµ„ã¿è¾¼ã¿`ConnectionError`ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰ã€‚ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®ãƒãƒƒã‚¯ã‚ªãƒ•ã‚„ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ãªã©ã®é«˜åº¦ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã¯å‚ç…§å®Ÿè£…ã§ã™ â€” ç’°å¢ƒã§æ¤œè¨¼ã—ã¦ãã ã•ã„ã€‚
</Note>

## ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼

ç„¡åŠ¹ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‡¦ç†ã—ã¾ã™ï¼š

```python
from shannon import ShannonClient, ValidationError

def validate_and_submit(query, session_id=None):
    client = ShannonClient()

    try:
        return client.submit_task(query=query, session_id=session_id)
    except ValidationError as e:
        print(f"ç„¡åŠ¹ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿: {e}")
        return None
```

## ã‚¿ã‚¹ã‚¯å¤±æ•—å‡¦ç†

ã‚¿ã‚¹ã‚¯å®Ÿè¡Œã®å¤±æ•—ã‚’å‡¦ç†ã—ã¾ã™ï¼š

```python
from shannon import ShannonClient, TaskTimeoutError, TaskStatusEnum

def handle_task_failure(query: str):
    client = ShannonClient()

    try:
        handle = client.submit_task(query=query)
        status = client.wait(handle.task_id, timeout=120)

        if status.status == TaskStatusEnum.FAILED:
            print(f"ã‚¿ã‚¹ã‚¯ãŒå¤±æ•—ã—ã¾ã—ãŸ: {status.error_message}")
            return None
        return status

    except TaskTimeoutError:
        print("ã‚¿ã‚¹ã‚¯ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ; ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’å¢—ã‚„ã™ã‹ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç°¡ç´ åŒ–ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚")
        return None
```

## ã‚¨ãƒ©ãƒ¼ãƒ­ã‚®ãƒ³ã‚°

åŒ…æ‹¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒ­ã‚®ãƒ³ã‚°ã‚’å®Ÿè£…ã—ã¾ã™ï¼š

```python
import logging
from shannon import ShannonClient, ShannonError

# ãƒ­ã‚®ãƒ³ã‚°ã®è¨­å®š
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger('shannon')

def logged_task_submission(query):
    client = ShannonClient()

    try:
        logger.info(f"ã‚¿ã‚¹ã‚¯ã‚’é€ä¿¡ä¸­: {query[:50]}...")
        handle = client.submit_task(query=query)

        logger.info(f"ã‚¿ã‚¹ã‚¯ãŒé€ä¿¡ã•ã‚Œã¾ã—ãŸ: task_id={handle.task_id}")
        result = client.wait(handle.task_id)

        logger.info("ã‚¿ã‚¹ã‚¯ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ")
        return result.result

    except ShannonError as e:
        logger.error(f"Shannonã‚¨ãƒ©ãƒ¼: {e}", exc_info=True)
        raise

    except Exception as e:
        logger.critical(f"äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼: {e}", exc_info=True)
        raise
```

## ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³

ãƒ¬ã‚¸ãƒªã‚¨ãƒ³ã‚¹ã®ãŸã‚ã«ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ã‚’å®Ÿè£…ã—ã¾ã™ï¼š

```python
class CircuitBreaker:
    def __init__(self, failure_threshold=5, reset_timeout=60):
        self.failure_count = 0
        self.failure_threshold = failure_threshold
        self.reset_timeout = reset_timeout
        self.last_failure_time = None
        self.state = "closed"  # closed, open, half-open

    def call(self, func, *args, **kwargs):
        if self.state == "open":
            if time.time() - self.last_failure_time > self.reset_timeout:
                self.state = "half-open"
            else:
                raise Exception("ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ã¯ã‚ªãƒ¼ãƒ—ãƒ³ã§ã™")

        try:
            result = func(*args, **kwargs)
            if self.state == "half-open":
                self.state = "closed"
                self.failure_count = 0
            return result

        except Exception as e:
            self.failure_count += 1
            self.last_failure_time = time.time()

            if self.failure_count >= self.failure_threshold:
                self.state = "open"

            raise

# ä½¿ç”¨ä¾‹
breaker = CircuitBreaker()
client = ShannonClient()

try:
    result = breaker.call(
        client.submit_task,
        query="ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã™ã‚‹"
    )
except Exception as e:
    print(f"ã‚µãƒ¼ãƒ“ã‚¹ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“: {e}")
```

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **ç‰¹å®šã®ä¾‹å¤–ã‚’å¸¸ã«ã‚­ãƒ£ãƒƒãƒ**ã—ã€ä¸€èˆ¬çš„ãªã‚‚ã®ã®å‰ã«ã™ã‚‹
2. **æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã‚’ä¼´ã†å†è©¦è¡Œãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹**
3. **ã‚¨ãƒ©ãƒ¼ã‚’ãƒ­ã‚°ã«è¨˜éŒ²**ã—ã¦ãƒ‡ãƒãƒƒã‚°ã¨ç›£è¦–ã‚’è¡Œã†
4. **é‡è¦ãªæ“ä½œã®ãŸã‚ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æä¾›ã™ã‚‹**
5. **ãƒãƒ³ã‚°ã‚’é¿ã‘ã‚‹ãŸã‚ã«åˆç†çš„ãªã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’è¨­å®šã™ã‚‹**
6. **é€ä¿¡å‰ã«å…¥åŠ›ã‚’æ¤œè¨¼ã™ã‚‹**
7. **å¤–éƒ¨ä¾å­˜é–¢ä¿‚ã«å¯¾ã—ã¦ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹**

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

<CardGroup cols={2}>
  <Card title="ä¾‹" icon="code" href="/ja/sdk/python/examples">
    ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å®Ÿä¾‹ã‚’å‚ç…§
  </Card>
  <Card title="éåŒæœŸä½¿ç”¨" icon="bolt" href="/ja/sdk/python/async-usage">
    éåŒæœŸã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³
  </Card>
</CardGroup>
## å®Œå…¨ãªå†è©¦è¡Œä¾‹

```python
#!/usr/bin/env python3
"""å†è©¦è¡Œãƒ­ã‚¸ãƒƒã‚¯ã‚’ä¼´ã†ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ä¾‹"""

import time
from shannon import ShannonClient, ConnectionError, TaskTimeoutError, ShannonError

def robust_task_submission(query: str, max_retries: int = 3):
    """
    å†è©¦è¡Œãƒ­ã‚¸ãƒƒã‚¯ã¨åŒ…æ‹¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ä¼´ã†ã‚¿ã‚¹ã‚¯ã‚’é€ä¿¡ã—ã¾ã™ã€‚

    Args:
        query: ã‚¿ã‚¹ã‚¯ã®ã‚¯ã‚¨ãƒª
        max_retries: å›å¾©å¯èƒ½ãªã‚¨ãƒ©ãƒ¼ã®æœ€å¤§å†è©¦è¡Œå›æ•°

    Returns:
        TaskStatusã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¾ãŸã¯ã™ã¹ã¦ã®è©¦è¡ŒãŒå¤±æ•—ã—ãŸå ´åˆã¯None
    """
    client = ShannonClient()

    for attempt in range(max_retries):
        try:
            print(f"\n[è©¦è¡Œ {attempt + 1}/{max_retries}] ã‚¿ã‚¹ã‚¯ã‚’é€ä¿¡ä¸­...")
            handle = client.submit_task(query=query)
            print(f"âœ… ã‚¿ã‚¹ã‚¯ãŒé€ä¿¡ã•ã‚Œã¾ã—ãŸ: {handle.task_id}")
            print("â³ çµæœã‚’å¾…ã£ã¦ã„ã¾ã™ï¼ˆ300ç§’ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰...")
            result = client.wait(handle.task_id, timeout=300)
            print("âœ… ã‚¿ã‚¹ã‚¯ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ")
            return result

        except ConnectionError as e:
            wait_time = 2 ** attempt  # 1s, 2s, 4s
            print(f"âŒ æ¥ç¶šã‚¨ãƒ©ãƒ¼: {e}")
            if attempt < max_retries - 1:
                print(f"â³ {wait_time}ç§’å¾Œã«å†è©¦è¡Œã—ã¾ã™...")
                time.sleep(wait_time)
            else:
                print(f"âŒ æœ€å¤§å†è©¦è¡Œå›æ•°ï¼ˆ{max_retries}ï¼‰ã«é”ã—ã¾ã—ãŸã€‚ã‚ãã‚‰ã‚ã¾ã™ã€‚")
                raise

        except TaskTimeoutError as e:
            print(f"âŒ ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼: {e}")
            print("âš ï¸  ã‚¿ã‚¹ã‚¯ãŒ300ç§’ã®åˆ¶é™ã‚’è¶…ãˆã¾ã—ãŸã€‚å†è©¦è¡Œã—ã¾ã›ã‚“ã€‚")
            raise

        except ShannonError as e:
            print(f"âŒ Shannon APIã‚¨ãƒ©ãƒ¼: {e}")
            print("âš ï¸  APIã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚å†è©¦è¡Œã—ã¾ã›ã‚“ã€‚")
            raise

        except Exception as e:
            print(f"âŒ äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼: {type(e).__name__}: {e}")
            raise

    return None


def main():
    print("=" * 60)
    print("ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ä¾‹")
    print("=" * 60)

    # ä¾‹1: é€šå¸¸ã®å®Ÿè¡Œ
    print("\nğŸ“ ä¾‹1: é€šå¸¸ã®å®Ÿè¡Œ")
    print("-" * 60)
    try:
        result = robust_task_submission("2+2ã¯ä½•ã§ã™ã‹ï¼Ÿ")
        if result:
            print(f"\næœ€çµ‚çµæœ: {result.result}")
    except Exception as e:
        print(f"\nâš ï¸  å¤±æ•—: {e}")

    # ä¾‹2: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚·ãƒŠãƒªã‚ªï¼ˆæ—©æœŸå¤±æ•—ï¼‰
    print("\n\nğŸ“ ä¾‹2: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚·ãƒŠãƒªã‚ª")
    print("-" * 60)
    print("æ³¨: ã“ã‚Œã¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†ã‚’ç¤ºã—ã¦ã„ã¾ã™")
    try:
        result = robust_task_submission(
            "ã“ã®è¤‡é›‘ãªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’åˆ†æã—ã¾ã™...ï¼ˆé•·ã„ã‚¿ã‚¹ã‚¯ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼‰"
        )
        if result:
            print(f"\næœ€çµ‚çµæœ: {result.result}")
    except TaskTimeoutError:
        print("\nâš ï¸  ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ - å†è©¦è¡Œã¯è¡Œã‚ã‚Œã¾ã›ã‚“ï¼ˆæœŸå¾…ã•ã‚Œã‚‹å‹•ä½œï¼‰")
    except Exception as e:
        print(f"\nâš ï¸  ã‚¨ãƒ©ãƒ¼: {e}")

    # ä¾‹3: ã‚·ãƒ³ãƒ—ãƒ«ãªtry/catchãƒ‘ã‚¿ãƒ¼ãƒ³
    print("\n\nğŸ“ ä¾‹3: ã‚·ãƒ³ãƒ—ãƒ«ãªtry-catchãƒ‘ã‚¿ãƒ¼ãƒ³")
    print("-" * 60)
    client = ShannonClient()
    try:
        handle = client.submit_task(query="ãƒ•ãƒ©ãƒ³ã‚¹ã®é¦–éƒ½ã¯ä½•ã§ã™ã‹ï¼Ÿ")
        result = client.wait(handle.task_id)
        print(f"âœ… æˆåŠŸ: {result.result}")
    except ConnectionError:
        print("âŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å•é¡Œ - Shannonã‚µãƒ¼ãƒ“ã‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„")
    except TaskTimeoutError:
        print("âŒ ã‚¿ã‚¹ã‚¯ãŒé•·ã™ãã¾ã—ãŸ")
    except ShannonError as e:
        print(f"âŒ APIã‚¨ãƒ©ãƒ¼: {e}")
    except Exception as e:
        print(f"âŒ äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼: {e}")

    print("\n" + "=" * 60)
    print("âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ä¾‹ãŒå®Œäº†ã—ã¾ã—ãŸï¼")
    print("=" * 60)


if __name__ == "__main__":
    main()
```

å®Ÿè¡Œã™ã‚‹ã«ã¯ï¼š

```bash
# ShannonãŒå®Ÿè¡Œä¸­ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
make dev

# ä¾‹ã‚’å®Ÿè¡Œ
python3 error_handling.py
```

å†è©¦è¡Œãƒ­ã‚¸ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼š

- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ä¸å®‰å®šã•
- ä¸€æ™‚çš„ãªã‚µãƒ¼ãƒ“ã‚¹ã®å•é¡Œ
- ãƒ¬ã‚¸ãƒªã‚¨ãƒ³ã‚¹ãŒå¿…è¦ãªãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ 

å†è©¦è¡Œã—ãªã„ã¹ãã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼š

- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆã‚¿ã‚¹ã‚¯ãŒè¤‡é›‘ã™ãã‚‹ï¼‰
- APIã‚¨ãƒ©ãƒ¼ï¼ˆç„¡åŠ¹ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
- èªè¨¼å¤±æ•—
