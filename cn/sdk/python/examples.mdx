---
title: "ä»£ç ç¤ºä¾‹"
description: "ä½¿ç”¨ Shannon Python SDK çš„å®ç”¨ç¤ºä¾‹"
---

<Note>
æ­¤ç¤ºä¾‹é›†åˆæ­£åœ¨å¢é•¿ã€‚å°†å®šæœŸæ·»åŠ æ›´å¤šç”¨ä¾‹ã€‚
</Note>

## åŸºæœ¬ç¤ºä¾‹

### æ¨¡å‹é€‰æ‹©

```python
from shannon import ShannonClient

client = ShannonClient(base_url="http://localhost:8080")
handle = client.submit_task(
  "å°†æ®µè½æ€»ç»“ä¸ºä¸‰ä¸ªé‡ç‚¹å…³æ³¨æ”¶å…¥è¶‹åŠ¿çš„è¦ç‚¹ã€‚è¾“å‡ºï¼šMarkdown åˆ—è¡¨ã€‚",
  model_tier="small",
  # model_override="gpt-5-nano-2025-08-07",
  # provider_override="openai",
  mode="simple",
)
print(client.wait(handle.task_id).result)
```

### ç®€å•é—®ç­”

```python
from shannon import ShannonClient

client = ShannonClient(base_url="http://localhost:8080")

# æå‡ºä¸€ä¸ªç®€å•é—®é¢˜
handle = client.submit_task(query="æ³•å›½çš„é¦–éƒ½æ˜¯ä»€ä¹ˆï¼Ÿ")
final = client.wait(handle.task_id)
print(f"ç­”æ¡ˆï¼š{final.result}")
```

### æ•°æ®åˆ†æ

```python
from shannon import ShannonClient

client = ShannonClient()

# è´´è¿‘çœŸå®çš„æ•°æ®åˆ†æ
handle = client.submit_task(
    query=(
        "ç»™å®šä»¥ä¸‹é”€å”®æ•°æ®ï¼Œè¯·è®¡ç®—ï¼š\n"
        "1. å„äº§å“çš„æ€»è¥æ”¶\n"
        "2. ç¯æ¯”å¢é•¿ç™¾åˆ†æ¯”\n"
        "3. è¿”å›æ€»è¥æ”¶ Top 3\n\n"
        "æ•°æ®ï¼š\n"
        "ProductA: Jan=$10000, Feb=$12000\n"
        "ProductB: Jan=$8000, Feb=$9500\n"
        "ProductC: Jan=$15000, Feb=$14000\n"
        "ProductD: Jan=$5000, Feb=$6000\n\n"
        "æ ¼å¼ï¼šJSON æ•°ç»„ [{product, revenue, mom_growth_pct}]"
    )
)

result = client.wait(handle.task_id)
print(result.result)
```

## é«˜çº§ç¤ºä¾‹

### å¤šæ­¥å·¥ä½œæµï¼ˆå¸¦ session_idï¼‰

```python
"""å¤šæ­¥å·¥ä½œæµç¤ºä¾‹ï¼ˆShannon SDKï¼‰"""
from shannon import ShannonClient

def main():
    client = ShannonClient()
    session_id = "quarterly-analysis-demo"

    print("=" * 60)
    print("å¤šæ­¥å·¥ä½œæµç¤ºä¾‹")
    print("=" * 60)

    # ç¬¬ 1 æ­¥ï¼šåˆå§‹æ•°æ®æŸ¥è¯¢
    print("\n[æ­¥éª¤ 1] åŠ è½½ Q4 æ•°æ®...")
    h1 = client.submit_task(
        query="1000 + 500 ç­‰äºå¤šå°‘ï¼Ÿå…¶ä¸­ 1000 è¡¨ç¤º Q4 è¥æ”¶ï¼Œ500 è¡¨ç¤ºæ”¯å‡ºã€‚",
        session_id=session_id
    )
    result1 = client.wait(h1.task_id)
    print(f"ç»“æœï¼š{result1.result}")

    # ç¬¬ 2 æ­¥ï¼šåŸºäºä¸Šä¸€ç»“æœçš„åˆ†æ
    print("\n[æ­¥éª¤ 2] åˆ†æè¶‹åŠ¿...")
    h2 = client.submit_task(
        query="åŸºäºä½ åˆšåˆšè®¡ç®—çš„ Q4 æ•°å­—ï¼Œåˆ©æ¶¦ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰æ˜¯å¤šå°‘ï¼Ÿ",
        session_id=session_id
    )
    result2 = client.wait(h2.task_id)
    print(f"ç»“æœï¼š{result2.result}")

    # ç¬¬ 3 æ­¥ï¼šæ±‡æ€»
    print("\n[æ­¥éª¤ 3] ç”Ÿæˆç®¡ç†æ‘˜è¦...")
    h3 = client.submit_task(
        query="ç”¨ä¸¤å¥è¯æ€»ç»“ Q4 è´¢åŠ¡åˆ†æã€‚",
        session_id=session_id
    )
    result3 = client.wait(h3.task_id)
    print(f"ç»“æœï¼š{result3.result}")

    print("\n" + "=" * 60)
    print("âœ… å¤šæ­¥å·¥ä½œæµå®Œæˆï¼")
    print(f"ä¼šè¯ ID: {session_id}")
    print("=" * 60)

if __name__ == "__main__":
    main()
```

### å¹¶è¡Œå¤„ç†

```python
"""å¹¶è¡Œå¤„ç†ç¤ºä¾‹ï¼ˆShannon SDKï¼‰"""
import asyncio
from shannon import AsyncShannonClient

async def main():
    print("=" * 60)
    print("å¹¶è¡Œå¤„ç†ç¤ºä¾‹")
    print("=" * 60)

    async with AsyncShannonClient() as client:
        # å¹¶è¡Œå¤„ç†çš„ä¸»é¢˜
        topics = ["AI", "é‡å­è®¡ç®—", "ç”Ÿç‰©æŠ€æœ¯"]

        print(f"\n[æ­¥éª¤ 1] å¹¶è¡Œæäº¤ {len(topics)} ä¸ªä»»åŠ¡â€¦")

        # éé˜»å¡å¹¶å‘æäº¤
        tasks = [
            client.submit_task(
                query=f"ç”¨ä¸€å¥è¯æ¦‚è¿° {topic} åŠå…¶ä¸»è¦åº”ç”¨ã€‚"
            )
            for topic in topics
        ]

        # ç­‰å¾…æ‰€æœ‰æäº¤å®Œæˆ
        handles = await asyncio.gather(*tasks)
        print(f"âœ… å·²æäº¤ {len(handles)} ä¸ªä»»åŠ¡")

        print("\n[æ­¥éª¤ 2] å¹¶è¡Œç­‰å¾…æ‰€æœ‰ç»“æœâ€¦")

        # å¹¶è¡Œç­‰å¾…æ‰€æœ‰ç»“æœ
        results = await asyncio.gather(
            *[client.wait(h.task_id) for h in handles]
        )
        print(f"âœ… å·²å®Œæˆ {len(results)} ä¸ªä»»åŠ¡")

        print("\n[æ­¥éª¤ 3] ç»“æœï¼š")
        print("-" * 60)

        # å±•ç¤ºç»“æœ
        for topic, result in zip(topics, results):
            print(f"\nğŸ“Œ {topic}:")
            print(f"   {result.result}")

            # å¦‚æœ‰å¯ç”¨ï¼Œå®‰å…¨è®¿é—®å…ƒæ•°æ®
            metadata = []
            if hasattr(result, 'metadata') and result.metadata:
                model = result.metadata.get('model_used') or result.metadata.get('model')
                if model:
                    metadata.append(f"Model: {model}")
                tokens = result.metadata.get('total_tokens')
                if tokens:
                    metadata.append(f"Tokens: {tokens}")

            if metadata:
                print(f"   ({', '.join(metadata)})")

        print("\n" + "=" * 60)
        print("âœ… å¹¶è¡Œå¤„ç†å®Œæˆï¼")
        print(f"å…±å¹¶è¡Œå¤„ç† {len(topics)} ä¸ªä¸»é¢˜")
        print("=" * 60)

if __name__ == "__main__":
    asyncio.run(main())
```

### å¸¦è¿‡æ»¤çš„æµå¼

```python
"""å¸¦è¿‡æ»¤å™¨çš„æµå¼ä¼ è¾“ç¤ºä¾‹"""
from shannon import ShannonClient, EventType

def main():
    print("=" * 60)
    print("å¸¦è¿‡æ»¤å™¨çš„æµå¼ä¼ è¾“ç¤ºä¾‹")
    print("=" * 60)

    client = ShannonClient()

    print("\n[æ­¥éª¤ 1] æäº¤ä»»åŠ¡â€¦")
    handle = client.submit_task(
        query=(
            "ç”¨ 3 å¥è¯æ¯”è¾ƒ AWSã€Azure ä¸ GCP çš„å®šä»·æ¨¡å¼ã€‚"
            "åœ¨ç”Ÿæˆæ—¶ä»¥æµå¼æ–¹å¼è¾“å‡ºã€‚"
        )
    )
    print(f"âœ… å·²æäº¤ä»»åŠ¡ï¼š{handle.task_id}")

    print("\n[æ­¥éª¤ 2] ä½¿ç”¨è¿‡æ»¤å™¨æµå¼ä¼ è¾“ [LLM_OUTPUT, WORKFLOW_COMPLETED]â€¦")
    print("-" * 60)

    event_count = 0
    llm_outputs = []

    # ä»…æµå¼ LLM_OUTPUT å’Œ WORKFLOW_COMPLETED
    for event in client.stream(
        handle.workflow_id,
        types=[EventType.LLM_OUTPUT, EventType.WORKFLOW_COMPLETED]
    ):
        event_count += 1
        print(f"[{event_count}] {event.type}")

        if event.type == EventType.LLM_OUTPUT:
            print(f"    å†…å®¹: {event.message[:80]}â€¦")
            llm_outputs.append(event.message)

        if event.type == EventType.WORKFLOW_COMPLETED:
            print(f"    çŠ¶æ€: {event.message}")
            break

    print("\n" + "-" * 60)
    print(f"âœ… æ”¶åˆ° {event_count} æ¡è¿‡æ»¤åçš„äº‹ä»¶")
    print(f"âœ… æ•è· {len(llm_outputs)} æ¡ LLM è¾“å‡º")

    print("\n[æ­¥éª¤ 3] å®Œæ•´ç»“æœï¼š")
    print("-" * 60)
    final = client.wait(handle.task_id)
    print(final.result)

    print("\n" + "=" * 60)
    print("âœ… å¸¦è¿‡æ»¤å™¨çš„æµå¼ä¼ è¾“å®Œæˆï¼")
    print("=" * 60)

if __name__ == "__main__":
    main()
```

å®Œæ•´äº‹ä»¶ç±»å‹åˆ—è¡¨å‚è§[äº‹ä»¶ç±»å‹ç›®å½•](/cn/api/event-types)ã€‚

<Note>
<b>å¯ç”¨äº‹ä»¶ç±»å‹</b>

- `LLM_OUTPUT` â€” æœ€ç»ˆ LLM å“åº”
- `LLM_PARTIAL` â€” å®æ—¶æµå¼ token
- `WORKFLOW_COMPLETED` â€” ä»»åŠ¡å®Œæˆ
- `AGENT_THINKING` â€” ä»£ç†æ¨ç†/æ€è€ƒ
- `AGENT_STARTED` â€” ä»£ç†å¼€å§‹å·¥ä½œ
- `AGENT_COMPLETED` â€” ä»£ç†å®Œæˆå·¥ä½œ
- `PROGRESS` â€” è¿›åº¦æ›´æ–°
- `ERROR_OCCURRED` â€” é”™è¯¯

<b>å¸¸è§è¿‡æ»¤ç»„åˆ</b>

- ä»…æœ€ç»ˆè¾“å‡ºï¼š`types=[EventType.LLM_OUTPUT, EventType.WORKFLOW_COMPLETED]`
- å®æ—¶æµå¼è¾“å‡ºï¼š`types=[EventType.LLM_PARTIAL, EventType.WORKFLOW_COMPLETED]`
- ç›‘æ§ä»£ç†ç”Ÿå‘½å‘¨æœŸï¼š`types=[EventType.AGENT_STARTED, EventType.AGENT_COMPLETED]`
- å…¨éƒ¨ï¼ˆä¸åŠ è¿‡æ»¤ï¼‰ï¼š`types=None`ï¼ˆæˆ–çœç•¥è¯¥å‚æ•°ï¼‰
</Note>

## ä»»åŠ¡æ§åˆ¶ç¤ºä¾‹

### æš‚åœå’Œæ¢å¤é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡

```python
"""ä»»åŠ¡æ§åˆ¶ï¼ˆæš‚åœ/æ¢å¤ï¼‰ç¤ºä¾‹"""
from shannon import ShannonClient
import time

def main():
    print("=" * 60)
    print("ä»»åŠ¡æ§åˆ¶ï¼ˆæš‚åœ/æ¢å¤ï¼‰ç¤ºä¾‹")
    print("=" * 60)

    client = ShannonClient(base_url="http://localhost:8080")

    # æäº¤é•¿æ—¶é—´è¿è¡Œçš„ç ”ç©¶ä»»åŠ¡
    print("\n[æ­¥éª¤ 1] æäº¤é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡...")
    handle = client.submit_task(
        query="ç ”ç©¶é‡å­è®¡ç®—å’Œ AI é›†æˆçš„æœ€æ–°å‘å±•ã€‚æä¾›è¯¦ç»†åˆ†æã€‚"
    )
    print(f"âœ… ä»»åŠ¡å·²æäº¤: {handle.task_id}")

    # è®©ä»»åŠ¡è¿è¡Œä¸€æ®µæ—¶é—´
    print("\n[æ­¥éª¤ 2] è®©ä»»åŠ¡è¿è¡Œ 5 ç§’...")
    time.sleep(5)

    # æš‚åœä»»åŠ¡
    print("\n[æ­¥éª¤ 3] æš‚åœä»»åŠ¡...")
    success = client.pause_task(handle.task_id, reason="æŸ¥çœ‹ä¸­é—´ç»“æœ")
    if success:
        print("âœ… æš‚åœä¿¡å·å·²å‘é€")

    # æ£€æŸ¥æ§åˆ¶çŠ¶æ€
    print("\n[æ­¥éª¤ 4] æ£€æŸ¥æ§åˆ¶çŠ¶æ€...")
    state = client.get_control_state(handle.task_id)
    print(f"æ˜¯å¦æš‚åœ: {state.is_paused}")
    print(f"æ˜¯å¦å–æ¶ˆ: {state.is_cancelled}")
    if state.paused_at:
        print(f"æš‚åœæ—¶é—´: {state.paused_at}")
        print(f"æš‚åœåŸå› : {state.pause_reason}")
        print(f"æš‚åœè€…: {state.paused_by}")

    # æ¢å¤å‰ç­‰å¾…ä¸€æ®µæ—¶é—´
    print("\n[æ­¥éª¤ 5] æ¢å¤å‰ç­‰å¾… 3 ç§’...")
    time.sleep(3)

    # æ¢å¤ä»»åŠ¡
    print("\n[æ­¥éª¤ 6] æ¢å¤ä»»åŠ¡...")
    success = client.resume_task(handle.task_id, reason="å®¡æŸ¥åç»§ç»­")
    if success:
        print("âœ… æ¢å¤ä¿¡å·å·²å‘é€")

    # ç­‰å¾…å®Œæˆ
    print("\n[æ­¥éª¤ 7] ç­‰å¾…ä»»åŠ¡å®Œæˆ...")
    result = client.wait(handle.task_id)
    print(f"\nâœ… ä»»åŠ¡å·²å®Œæˆ!")
    print(f"çŠ¶æ€: {result.status}")
    print(f"\nç»“æœé¢„è§ˆ: {result.result[:200]}...")

    print("\n" + "=" * 60)
    print("âœ… ä»»åŠ¡æ§åˆ¶ç¤ºä¾‹å®Œæˆ!")
    print("=" * 60)

if __name__ == "__main__":
    main()
```

### æ§åˆ¶ä¿¡å·çš„é”™è¯¯å¤„ç†

```python
"""æš‚åœ/æ¢å¤æ“ä½œçš„é”™è¯¯å¤„ç†"""
from shannon import ShannonClient
from shannon.errors import ShannonError

def main():
    client = ShannonClient()

    task_id = "task-123"

    # å°è¯•æš‚åœ
    try:
        client.pause_task(task_id, reason="éœ€è¦å®¡æŸ¥")
        print("âœ… ä»»åŠ¡æš‚åœæˆåŠŸ")
    except ShannonError as e:
        # å¤„ç†ç‰¹å®šé”™è¯¯æƒ…å†µ
        if "cannot pause completed task" in str(e):
            print("âš ï¸  ä»»åŠ¡å·²å®Œæˆï¼Œæ— æ³•æš‚åœ")
        elif "task is already paused" in str(e):
            print("âš ï¸  ä»»åŠ¡å·²ç»å¤„äºæš‚åœçŠ¶æ€")
        elif "Task not found" in str(e):
            print("âŒ æœªæ‰¾åˆ°ä»»åŠ¡")
        else:
            print(f"âŒ é”™è¯¯: {e}")

    # å°è¯•æ¢å¤
    try:
        client.resume_task(task_id, reason="ç»§ç»­æ‰§è¡Œ")
        print("âœ… ä»»åŠ¡æ¢å¤æˆåŠŸ")
    except ShannonError as e:
        if "task is not paused" in str(e):
            print("âš ï¸  ä»»åŠ¡æœªæš‚åœï¼Œæ— æ³•æ¢å¤")
        elif "cannot resume completed task" in str(e):
            print("âš ï¸  ä»»åŠ¡å·²å®Œæˆï¼Œæ— æ³•æ¢å¤")
        else:
            print(f"âŒ é”™è¯¯: {e}")

if __name__ == "__main__":
    main()
```

## çœŸå®ç”¨ä¾‹

{/* æœ¬èŠ‚ç¤ºä¾‹å·²ç§»é™¤ä»¥ä¿æŒé¡µé¢ç®€æ´ã€‚ */}

## é”™è¯¯å¤„ç†ç¤ºä¾‹

å‚è§ä¸“é—¨é¡µé¢è·å–å®Œæ•´çš„é‡è¯•é€»è¾‘ä¸æ¨¡å¼ï¼š[é”™è¯¯å¤„ç†](/cn/sdk/python/error-handling)ã€‚

è¿è¡Œæ–¹æ³•ï¼š

```bash
# ç¡®ä¿ Shannon å·²è¿è¡Œ
make dev

# è¿è¡Œç¤ºä¾‹
python3 error_handling.py
```

ä½•æ—¶ä½¿ç”¨é‡è¯•ï¼š

- ç½‘ç»œä¸ç¨³å®š
- ä¸´æ—¶æ€§æœåŠ¡é—®é¢˜
- å¯¹å¯é æ€§æœ‰è¦æ±‚çš„ç”Ÿäº§ç³»ç»Ÿ

ä¸å»ºè®®é‡è¯•ï¼š

- è¶…æ—¶ï¼ˆä»»åŠ¡æœ¬èº«è¿‡äºå¤æ‚/è€—æ—¶ï¼‰
- API é”™è¯¯ï¼ˆå‚æ•°æ— æ•ˆç­‰ï¼‰
- è®¤è¯å¤±è´¥

## åç»­æ­¥éª¤

<CardGroup cols={2}>
  <Card title="å¼‚æ­¥ç”¨æ³•" icon="bolt" href="/cn/sdk/python/async-usage">
    Async/await æ¨¡å¼
  </Card>
  <Card title="é”™è¯¯å¤„ç†" icon="shield" href="/cn/sdk/python/error-handling">
    æ­£ç¡®å¤„ç†é”™è¯¯
  </Card>
</CardGroup>
