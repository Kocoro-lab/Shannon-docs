---
title: "代码示例"
description: "使用 Shannon Python SDK 的实用示例"
---

<Note>
此示例集合正在增长。将定期添加更多用例。
</Note>

## 基本示例

### 简单问答

```python
from shannon import ShannonClient

client = ShannonClient(base_url="http://localhost:8080")

# 提出一个简单问题
handle = client.submit_task(query="法国的首都是什么？")
final = client.wait(handle.task_id)
print(f"答案：{final.result}")
```

### 数据分析

```python
# 分析 CSV 数据
handle = client.submit_task(
    query="分析此 CSV 文件中的销售趋势",
    # 模式自动选择,
    context={"file_path": "/data/sales_2024.csv"}
)

# 流式传输进度
for event in client.stream(handle.workflow_id):
    print(f"[{event.type}] {event.message}")
    if event.type == "WORKFLOW_COMPLETED":
        break
```

## 高级示例

### 多步工作流（带 session_id）

```python
from shannon import ShannonClient

def complex_analysis():
    client = ShannonClient()
    session_id = "quarterly-analysis"

    # 第 1 步：加载数据
    load_handle = client.submit_task(
        query="从数据库加载 Q4 财务数据",
        session_id=session_id,
    )
    client.wait(load_handle.task_id)

    # 第 2 步：分析趋势（继承第 1 步上下文）
    analyze_handle = client.submit_task(
        query="识别前 3 个收入趋势",
        session_id=session_id,
    )
    trends = client.wait(analyze_handle.task_id)

    # 第 3 步：生成报告
    report_handle = client.submit_task(
        query="创建带有可视化的执行摘要",
        session_id=session_id,
    )

    return client.wait(report_handle.task_id)
```

### 并行处理

```python
import asyncio
from shannon import AsyncShannonClient

async def parallel_research(topics):
    async with AsyncShannonClient() as client:
        # 并行提交所有研究任务
        tasks = [
            client.submit_task(
                query=f"研究 {topic} 的最新发展",
                # 模式自动选择
            )
            for topic in topics
        ]

        # 等待所有句柄
        handles = await asyncio.gather(*tasks)

        # 收集所有结果
        results = await asyncio.gather(*[
            client.wait(h.task_id)
            for h in handles
        ])

        return dict(zip(topics, results))

# 使用它
topics = ["AI", "量子计算", "生物技术"]
results = asyncio.run(parallel_research(topics))
```

### 带过滤的流式

```python
from shannon import EventType

handle = client.submit_task(query="研究云服务商")
for event in client.stream(
    handle.workflow_id,
    types=[EventType.LLM_OUTPUT, EventType.WORKFLOW_COMPLETED],
):
    print(event.type)
    if event.type == EventType.WORKFLOW_COMPLETED:
        break
```

## 真实用例

{/* 移除了使用不受支持会话 API 的示例 */}

### 代码审查助手

```python
def automated_code_review(file_path, language="python"):
    client = ShannonClient()

    with open(file_path, 'r') as f:
        code = f.read()

    handle = client.submit_task(
        query=f"检查此 {language} 代码的错误、安全问题和改进",
        # 模式自动选择,
        context={"code": code}
    )

    # 追踪进度
    for event in client.stream(handle.workflow_id):
        print(f"[{event.type}] {event.message}")
        if event.type == "WORKFLOW_COMPLETED":
            break

    return client.wait(handle.task_id)

# 使用它
review = automated_code_review("app.py")
print(review)
```

{/* 移除了冗长的研究助手示例以保持简洁 */}

## 错误处理示例

```python
from shannon import ShannonClient, ShannonError, ConnectionError, TaskTimeoutError
import time

def robust_task_submission(query, max_retries=3):
    client = ShannonClient()

    for attempt in range(max_retries):
        try:
            # 提交任务
            handle = client.submit_task(query=query)  # 模式自动选择

            # 等待超时
            result = client.wait(handle.task_id, timeout=300)

            return result

        except ConnectionError:
            if attempt < max_retries - 1:
                time.sleep(2 ** attempt)  # 指数退避
                continue
            raise

        except TaskTimeoutError:
            print("任务超时")
            raise
        except ShannonError as e:
            print(f"Shannon 错误：{e}")
            raise
```

## 后续步骤

<CardGroup cols={2}>
  <Card title="异步用法" icon="bolt" href="/cn/sdk/python/async-usage">
    Async/await 模式
  </Card>
  <Card title="错误处理" icon="shield" href="/cn/sdk/python/error-handling">
    正确处理错误
  </Card>
</CardGroup>
