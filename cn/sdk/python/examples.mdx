---
title: "代码示例"
description: "使用 Shannon Python SDK 的实用示例"
---

<Note>
此示例集合正在增长。将定期添加更多用例。
</Note>

## 基本示例

### 简单问答

```python
from shannon import ShannonClient

client = ShannonClient(http_endpoint="http://localhost:8080")

# 提出一个简单问题
handle = client.submit_task(
    query="法国的首都是什么？",
    # 模式自动选择
)

result = client.get_status(handle.workflow_id)
print(f"答案：{result}")
```

### 数据分析

```python
# 分析 CSV 数据
handle = client.submit_task(
    query="分析此 CSV 文件中的销售趋势",
    # 模式自动选择,
    context={"file_path": "/data/sales_2024.csv"}
)

# 流式传输进度
for event in client.stream(handle.workflow_id):
    if event.type == "AGENT_THINKING":
        print(f"分析中：{event.message}")
    elif event.type == "TASK_COMPLETED":
        print(f"分析：{event.data['result']}")
        break
```

## 高级示例

### 多步工作流

```python
from shannon import ShannonClient

def complex_analysis():
    client = ShannonClient()

    # 为上下文创建会话
    session = client.create_session(name="季度分析")

    # 第 1 步：加载数据
    load_handle = client.submit_task(
        query="从数据库加载 Q4 财务数据",
        session_id=session.id,
        # 模式自动选择
    )
    client.wait(load_handle.workflow_id)

    # 第 2 步：分析趋势（具有第 1 步的上下文）
    analyze_handle = client.submit_task(
        query="识别前 3 个收入趋势",
        session_id=session.id,
        # 模式自动选择
    )
    trends = client.get_status(analyze_handle.workflow_id)

    # 第 3 步：生成报告
    report_handle = client.submit_task(
        query="创建带有可视化的执行摘要",
        session_id=session.id,
        # 模式自动选择
    )

    return client.get_status(report_handle.workflow_id)
```

### 并行处理

```python
import asyncio
from shannon import AsyncShannonClient

async def parallel_research(topics):
    async with AsyncShannonClient() as client:
        # 并行提交所有研究任务
        tasks = [
            client.submit_task(
                query=f"研究 {topic} 的最新发展",
                # 模式自动选择
            )
            for topic in topics
        ]

        # 等待所有句柄
        handles = await asyncio.gather(*tasks)

        # 收集所有结果
        results = await asyncio.gather(*[
            client.get_status(h.workflow_id)
            for h in handles
        ])

        return dict(zip(topics, results))

# 使用它
topics = ["AI", "量子计算", "生物技术"]
results = asyncio.run(parallel_research(topics))
```

### 自定义预算管理

```python
def budget_controlled_task():
    client = ShannonClient()

    # 设置严格的预算限制
    config = {
        "budget": {
            "max_cost_usd": 0.50,
            "max_input_tokens": 10000,
            "max_output_tokens": 5000,
            "max_iterations": 3
        },
        "model_preferences": {
            "preferred_models": ["gpt-3.5-turbo"],
            "temperature": 0.7
        }
    }

    handle = client.submit_task(
        query="生成产品描述",
        # 模式自动选择,
        config=config
    )

    # 监控成本
    for event in client.stream(handle.workflow_id):
        if event.type == "BUDGET_UPDATE":
            print(f"到目前为止的成本：${event.data['cost_usd']:.3f}")
        elif event.type == "TASK_COMPLETED":
            break

    result = client.get_status(handle.workflow_id)
    return result
```

## 真实用例

### 客户支持机器人

```python
class SupportBot:
    def __init__(self):
        self.client = ShannonClient()
        self.session = None

    def start_conversation(self, customer_id):
        self.session = self.client.create_session(
            name=f"Support-{customer_id}"
        )

    def handle_query(self, message):
        handle = self.client.submit_task(
            query=f"帮助客户：{message}",
            session_id=self.session.id,
            # 模式自动选择,
            config={
                "context": {
                    "role": "customer_support",
                    "tone": "friendly and helpful"
                }
            }
        )

        return self.client.get_status(handle.workflow_id)

    def end_conversation(self):
        self.client.delete_session(self.session.id)

# 用法
bot = SupportBot()
bot.start_conversation("cust_12345")
response = bot.handle_query("我如何重置密码？")
print(response)
bot.end_conversation()
```

### 代码审查助手

```python
def automated_code_review(file_path, language="python"):
    client = ShannonClient()

    with open(file_path, 'r') as f:
        code = f.read()

    handle = client.submit_task(
        query=f"检查此 {language} 代码的错误、安全问题和改进",
        # 模式自动选择,
        context={"code": code}
    )

    # 追踪进度
    for event in client.stream(handle.workflow_id):
        if event.type == "AGENT_THINKING":
            print(f"审查中：{event.message}")
        elif event.type == "TOOL_INVOKED":
            print(f"使用工具：{event.data['tool_name']}")

    return client.get_status(handle.workflow_id)

# 使用它
review = automated_code_review("app.py")
print(review)
```

### 研究助手

```python
class ResearchAssistant:
    def __init__(self):
        self.client = ShannonClient()

    def research_topic(self, topic, depth="standard"):
        """使用可配置的深度研究主题"""
        queries = {
            "simple": f"提供 {topic} 的简要概述",
            "standard": f"研究 {topic}，包括关键概念、最新发展和应用",
            "advanced": f"关于 {topic} 的全面研究，包含引文、比较和批判性分析"
        }

        handle = self.client.submit_task(
            query=queries[depth],
            context={
                "depth": depth,
                "tools": ["web_search", "arxiv", "wikipedia"]
            }
        )

        return self.client.get_status(handle.workflow_id)

    def compare_topics(self, topics):
        """比较多个主题"""
        query = f"比较和对比：{', '.join(topics)}"

        handle = self.client.submit_task(
            query=query,
            # 模式自动选择
        )

        return self.client.get_status(handle.workflow_id)

# 用法
assistant = ResearchAssistant()
overview = assistant.research_topic("大型语言模型", depth="standard")
comparison = assistant.compare_topics(["GPT-4", "Claude", "Gemini"])
```

## 错误处理示例

```python
from shannon import ShannonClient, ShannonError
import time

def robust_task_submission(query, max_retries=3):
    client = ShannonClient()

    for attempt in range(max_retries):
        try:
            # 提交任务
            handle = client.submit_task(query=query, # 模式自动选择)

            # 等待超时
            result = client.wait(
                handle.workflow_id,
                timeout_seconds=300
            )

            return result

        except ConnectionError:
            if attempt < max_retries - 1:
                time.sleep(2 ** attempt)  # 指数退避
                continue
            raise

        except ShannonError as e:
            print(f"Shannon 错误：{e}")
            if e.error_code == "BUDGET_EXCEEDED":
                # 尝试使用更低的预算
                return client.submit_task(
                    query=query,
                    # 模式自动选择,
                    config={"budget": {"max_cost_usd": 0.10}}
                )
            raise
```

## 后续步骤

<CardGroup cols={2}>
  <Card title="异步用法" icon="bolt" href="/cn/sdk/python/async-usage">
    Async/await 模式
  </Card>
  <Card title="错误处理" icon="shield" href="/cn/sdk/python/error-handling">
    正确处理错误
  </Card>
</CardGroup>
