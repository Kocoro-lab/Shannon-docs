---
title: "ä»£ç ç¤ºä¾‹"
description: "ä½¿ç”¨ Shannon Python SDK çš„å®ç”¨ç¤ºä¾‹"
---

<Note>
æ­¤ç¤ºä¾‹é›†åˆæ­£åœ¨å¢é•¿ã€‚å°†å®šæœŸæ·»åŠ æ›´å¤šç”¨ä¾‹ã€‚
</Note>

## åŸºæœ¬ç¤ºä¾‹

### æ¨¡å‹é€‰æ‹©

```python
from shannon import ShannonClient

client = ShannonClient(base_url="http://localhost:8080")
handle = client.submit_task(
  "ä¸ºæ­¤æ–‡æ¡£ç”Ÿæˆæ‘˜è¦",
  model_tier="small",
  # model_override="gpt-5-nano-2025-08-07",
  # provider_override="openai",
  mode="simple",
)
print(client.wait(handle.task_id).result)
```

### ç®€å•é—®ç­”

```python
from shannon import ShannonClient

client = ShannonClient(base_url="http://localhost:8080")

# æå‡ºä¸€ä¸ªç®€å•é—®é¢˜
handle = client.submit_task(query="æ³•å›½çš„é¦–éƒ½æ˜¯ä»€ä¹ˆï¼Ÿ")
final = client.wait(handle.task_id)
print(f"ç­”æ¡ˆï¼š{final.result}")
```

### æ•°æ®åˆ†æ

```python
from shannon import ShannonClient

client = ShannonClient()

# è´´è¿‘çœŸå®çš„æ•°æ®åˆ†æ
handle = client.submit_task(
    query=(
        "ç»™å®šä»¥ä¸‹é”€å”®æ•°æ®ï¼Œè¯·è®¡ç®—ï¼š\n"
        "1. å„äº§å“çš„æ€»è¥æ”¶\n"
        "2. ç¯æ¯”å¢é•¿ç™¾åˆ†æ¯”\n"
        "3. è¿”å›æ€»è¥æ”¶ Top 3\n\n"
        "æ•°æ®ï¼š\n"
        "ProductA: Jan=$10000, Feb=$12000\n"
        "ProductB: Jan=$8000, Feb=$9500\n"
        "ProductC: Jan=$15000, Feb=$14000\n"
        "ProductD: Jan=$5000, Feb=$6000\n\n"
        "æ ¼å¼ï¼šJSON æ•°ç»„ [{product, revenue, mom_growth_pct}]"
    )
)

result = client.wait(handle.task_id)
print(result.result)
```

## é«˜çº§ç¤ºä¾‹

### å¤šæ­¥å·¥ä½œæµï¼ˆå¸¦ session_idï¼‰

```python
"""å¤šæ­¥å·¥ä½œæµç¤ºä¾‹ï¼ˆShannon SDKï¼‰"""
from shannon import ShannonClient

def main():
    client = ShannonClient()
    session_id = "quarterly-analysis-demo"

    print("=" * 60)
    print("å¤šæ­¥å·¥ä½œæµç¤ºä¾‹")
    print("=" * 60)

    # ç¬¬ 1 æ­¥ï¼šåˆå§‹æ•°æ®æŸ¥è¯¢
    print("\n[æ­¥éª¤ 1] åŠ è½½ Q4 æ•°æ®...")
    h1 = client.submit_task(
        query="1000 + 500 ç­‰äºå¤šå°‘ï¼Ÿå…¶ä¸­ 1000 è¡¨ç¤º Q4 è¥æ”¶ï¼Œ500 è¡¨ç¤ºæ”¯å‡ºã€‚",
        session_id=session_id
    )
    result1 = client.wait(h1.task_id)
    print(f"ç»“æœï¼š{result1.result}")

    # ç¬¬ 2 æ­¥ï¼šåŸºäºä¸Šä¸€ç»“æœçš„åˆ†æ
    print("\n[æ­¥éª¤ 2] åˆ†æè¶‹åŠ¿...")
    h2 = client.submit_task(
        query="åŸºäºä½ åˆšåˆšè®¡ç®—çš„ Q4 æ•°å­—ï¼Œåˆ©æ¶¦ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰æ˜¯å¤šå°‘ï¼Ÿ",
        session_id=session_id
    )
    result2 = client.wait(h2.task_id)
    print(f"ç»“æœï¼š{result2.result}")

    # ç¬¬ 3 æ­¥ï¼šæ±‡æ€»
    print("\n[æ­¥éª¤ 3] ç”Ÿæˆç®¡ç†æ‘˜è¦...")
    h3 = client.submit_task(
        query="ç”¨ä¸¤å¥è¯æ€»ç»“ Q4 è´¢åŠ¡åˆ†æã€‚",
        session_id=session_id
    )
    result3 = client.wait(h3.task_id)
    print(f"ç»“æœï¼š{result3.result}")

    print("\n" + "=" * 60)
    print("âœ… å¤šæ­¥å·¥ä½œæµå®Œæˆï¼")
    print(f"ä¼šè¯ ID: {session_id}")
    print("=" * 60)

if __name__ == "__main__":
    main()
```

### å¹¶è¡Œå¤„ç†

```python
"""å¹¶è¡Œå¤„ç†ç¤ºä¾‹ï¼ˆShannon SDKï¼‰"""
import asyncio
from shannon import AsyncShannonClient

async def main():
    print("=" * 60)
    print("å¹¶è¡Œå¤„ç†ç¤ºä¾‹")
    print("=" * 60)

    async with AsyncShannonClient() as client:
        # å¹¶è¡Œå¤„ç†çš„ä¸»é¢˜
        topics = ["AI", "é‡å­è®¡ç®—", "ç”Ÿç‰©æŠ€æœ¯"]

        print(f"\n[æ­¥éª¤ 1] å¹¶è¡Œæäº¤ {len(topics)} ä¸ªä»»åŠ¡â€¦")

        # éé˜»å¡å¹¶å‘æäº¤
        tasks = [
            client.submit_task(
                query=f"ç”¨ä¸€å¥è¯æ¦‚è¿° {topic} åŠå…¶ä¸»è¦åº”ç”¨ã€‚"
            )
            for topic in topics
        ]

        # ç­‰å¾…æ‰€æœ‰æäº¤å®Œæˆ
        handles = await asyncio.gather(*tasks)
        print(f"âœ… å·²æäº¤ {len(handles)} ä¸ªä»»åŠ¡")

        print("\n[æ­¥éª¤ 2] å¹¶è¡Œç­‰å¾…æ‰€æœ‰ç»“æœâ€¦")

        # å¹¶è¡Œç­‰å¾…æ‰€æœ‰ç»“æœ
        results = await asyncio.gather(
            *[client.wait(h.task_id) for h in handles]
        )
        print(f"âœ… å·²å®Œæˆ {len(results)} ä¸ªä»»åŠ¡")

        print("\n[æ­¥éª¤ 3] ç»“æœï¼š")
        print("-" * 60)

        # å±•ç¤ºç»“æœ
        for topic, result in zip(topics, results):
            print(f"\nğŸ“Œ {topic}:")
            print(f"   {result.result}")

            # å¦‚æœ‰å¯ç”¨ï¼Œå®‰å…¨è®¿é—®å…ƒæ•°æ®
            metadata = []
            if hasattr(result, 'metadata') and result.metadata:
                model = result.metadata.get('model_used') or result.metadata.get('model')
                if model:
                    metadata.append(f"Model: {model}")
                tokens = result.metadata.get('total_tokens')
                if tokens:
                    metadata.append(f"Tokens: {tokens}")

            if metadata:
                print(f"   ({', '.join(metadata)})")

        print("\n" + "=" * 60)
        print("âœ… å¹¶è¡Œå¤„ç†å®Œæˆï¼")
        print(f"å…±å¹¶è¡Œå¤„ç† {len(topics)} ä¸ªä¸»é¢˜")
        print("=" * 60)

if __name__ == "__main__":
    asyncio.run(main())
```

### å¸¦è¿‡æ»¤çš„æµå¼

```python
"""å¸¦è¿‡æ»¤å™¨çš„æµå¼ä¼ è¾“ç¤ºä¾‹"""
from shannon import ShannonClient, EventType

def main():
    print("=" * 60)
    print("å¸¦è¿‡æ»¤å™¨çš„æµå¼ä¼ è¾“ç¤ºä¾‹")
    print("=" * 60)

    client = ShannonClient()

    print("\n[æ­¥éª¤ 1] æäº¤ä»»åŠ¡â€¦")
    handle = client.submit_task(
        query=(
            "ç”¨ 3 å¥è¯æ¯”è¾ƒ AWSã€Azure ä¸ GCP çš„å®šä»·æ¨¡å¼ã€‚"
            "åœ¨ç”Ÿæˆæ—¶ä»¥æµå¼æ–¹å¼è¾“å‡ºã€‚"
        )
    )
    print(f"âœ… å·²æäº¤ä»»åŠ¡ï¼š{handle.task_id}")

    print("\n[æ­¥éª¤ 2] ä½¿ç”¨è¿‡æ»¤å™¨æµå¼ä¼ è¾“ [LLM_OUTPUT, WORKFLOW_COMPLETED]â€¦")
    print("-" * 60)

    event_count = 0
    llm_outputs = []

    # ä»…æµå¼ LLM_OUTPUT å’Œ WORKFLOW_COMPLETED
    for event in client.stream(
        handle.workflow_id,
        types=[EventType.LLM_OUTPUT, EventType.WORKFLOW_COMPLETED]
    ):
        event_count += 1
        print(f"[{event_count}] {event.type}")

        if event.type == EventType.LLM_OUTPUT:
            print(f"    å†…å®¹: {event.message[:80]}â€¦")
            llm_outputs.append(event.message)

        if event.type == EventType.WORKFLOW_COMPLETED:
            print(f"    çŠ¶æ€: {event.message}")
            break

    print("\n" + "-" * 60)
    print(f"âœ… æ”¶åˆ° {event_count} æ¡è¿‡æ»¤åçš„äº‹ä»¶")
    print(f"âœ… æ•è· {len(llm_outputs)} æ¡ LLM è¾“å‡º")

    print("\n[æ­¥éª¤ 3] å®Œæ•´ç»“æœï¼š")
    print("-" * 60)
    final = client.wait(handle.task_id)
    print(final.result)

    print("\n" + "=" * 60)
    print("âœ… å¸¦è¿‡æ»¤å™¨çš„æµå¼ä¼ è¾“å®Œæˆï¼")
    print("=" * 60)

if __name__ == "__main__":
    main()
```

å®Œæ•´äº‹ä»¶ç±»å‹åˆ—è¡¨å‚è§[äº‹ä»¶ç±»å‹ç›®å½•](/cn/api/event-types)ã€‚

<Note>
<b>å¯ç”¨äº‹ä»¶ç±»å‹</b>

- `LLM_OUTPUT` â€” æœ€ç»ˆ LLM å“åº”
- `LLM_PARTIAL` â€” å®æ—¶æµå¼ token
- `WORKFLOW_COMPLETED` â€” ä»»åŠ¡å®Œæˆ
- `AGENT_THINKING` â€” ä»£ç†æ¨ç†/æ€è€ƒ
- `AGENT_STARTED` â€” ä»£ç†å¼€å§‹å·¥ä½œ
- `AGENT_COMPLETED` â€” ä»£ç†å®Œæˆå·¥ä½œ
- `PROGRESS` â€” è¿›åº¦æ›´æ–°
- `ERROR_OCCURRED` â€” é”™è¯¯

<b>å¸¸è§è¿‡æ»¤ç»„åˆ</b>

- ä»…æœ€ç»ˆè¾“å‡ºï¼š`types=[EventType.LLM_OUTPUT, EventType.WORKFLOW_COMPLETED]`
- å®æ—¶æµå¼è¾“å‡ºï¼š`types=[EventType.LLM_PARTIAL, EventType.WORKFLOW_COMPLETED]`
- ç›‘æ§ä»£ç†ç”Ÿå‘½å‘¨æœŸï¼š`types=[EventType.AGENT_STARTED, EventType.AGENT_COMPLETED]`
- å…¨éƒ¨ï¼ˆä¸åŠ è¿‡æ»¤ï¼‰ï¼š`types=None`ï¼ˆæˆ–çœç•¥è¯¥å‚æ•°ï¼‰
</Note>

## çœŸå®ç”¨ä¾‹

{/* æœ¬èŠ‚ç¤ºä¾‹å·²ç§»é™¤ä»¥ä¿æŒé¡µé¢ç®€æ´ã€‚ */}

## é”™è¯¯å¤„ç†ç¤ºä¾‹

```python
#!/usr/bin/env python3
"""å¸¦é‡è¯•é€»è¾‘çš„é”™è¯¯å¤„ç†ç¤ºä¾‹"""

import time
from shannon import ShannonClient, ConnectionError, TaskTimeoutError, ShannonError

def robust_task_submission(query: str, max_retries: int = 3):
    """
    ä½¿ç”¨é‡è¯•é€»è¾‘æäº¤ä»»åŠ¡ï¼Œå¹¶åŒ…å«å…¨é¢çš„é”™è¯¯å¤„ç†ã€‚

    å‚æ•°ï¼š
        query: ä»»åŠ¡æŸ¥è¯¢å†…å®¹
        max_retries: å¯é‡è¯•é”™è¯¯çš„æœ€å¤§é‡è¯•æ¬¡æ•°

    è¿”å›ï¼š
        TaskStatus å¯¹è±¡ï¼›è‹¥æ‰€æœ‰å°è¯•å‡å¤±è´¥åˆ™è¿”å› None
    """
    client = ShannonClient()

    for attempt in range(max_retries):
        try:
            print(f"\n[å°è¯• {attempt + 1}/{max_retries}] æ­£åœ¨æäº¤ä»»åŠ¡â€¦")

            # æäº¤ä»»åŠ¡
            handle = client.submit_task(query=query)
            print(f"âœ… å·²æäº¤ä»»åŠ¡ï¼š{handle.task_id}")

            # å¸¦è¶…æ—¶ç­‰å¾…ç»“æœ
            print("â³ ç­‰å¾…ç»“æœï¼ˆ300s è¶…æ—¶ï¼‰â€¦")
            result = client.wait(handle.task_id, timeout=300)

            print("âœ… ä»»åŠ¡æˆåŠŸå®Œæˆ")
            return result

        except ConnectionError as e:
            # å¯æ¢å¤ï¼šæŒ‡æ•°é€€é¿åé‡è¯•
            wait_time = 2 ** attempt  # 1s, 2s, 4s
            print(f"âŒ è¿æ¥é”™è¯¯ï¼š{e}")

            if attempt < max_retries - 1:
                print(f"â³ {wait_time} ç§’åé‡è¯•â€¦")
                time.sleep(wait_time)
            else:
                print(f"âŒ å·²è¾¾æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆ{max_retries}ï¼‰ï¼Œæ”¾å¼ƒã€‚")
                raise

        except TaskTimeoutError as e:
            # ç»ˆæ­¢ï¼šä»»åŠ¡è€—æ—¶è¿‡é•¿
            print(f"âŒ ä»»åŠ¡è¶…æ—¶ï¼š{e}")
            print("âš ï¸  è¶…è¿‡ 300 ç§’é™åˆ¶ï¼Œä¸å†é‡è¯•ã€‚")
            raise

        except ShannonError as e:
            # ç»ˆæ­¢ï¼šAPI çº§é”™è¯¯
            print(f"âŒ Shannon API é”™è¯¯ï¼š{e}")
            print("âš ï¸  é‡åˆ° API é”™è¯¯ï¼Œä¸å†é‡è¯•ã€‚")
            raise

        except Exception as e:
            # æœªé¢„æœŸé”™è¯¯
            print(f"âŒ æœªé¢„æœŸé”™è¯¯ï¼š{type(e).__name__}: {e}")
            raise

    return None


def main():
    print("=" * 60)
    print("é”™è¯¯å¤„ç†ç¤ºä¾‹")
    print("=" * 60)

    # ç¤ºä¾‹ 1ï¼šæ­£å¸¸æ‰§è¡Œ
    print("\nğŸ“ ç¤ºä¾‹ 1ï¼šæ­£å¸¸æ‰§è¡Œ")
    print("-" * 60)
    try:
        result = robust_task_submission("2+2 ç­‰äºå¤šå°‘ï¼Ÿ")
        if result:
            print(f"\næœ€ç»ˆç»“æœï¼š{result.result}")
    except Exception as e:
        print(f"\nâš ï¸  å¤±è´¥ï¼š{e}")

    # ç¤ºä¾‹ 2ï¼šè¶…æ—¶åœºæ™¯ï¼ˆæ¼”ç¤ºä¸é‡è¯•ï¼‰
    print("\n\nğŸ“ ç¤ºä¾‹ 2ï¼šè¶…æ—¶åœºæ™¯")
    print("-" * 60)
    print("æç¤ºï¼šæ­¤å¤„æ¼”ç¤ºè¶…æ—¶å¤„ç†")
    try:
        result = robust_task_submission(
            "åˆ†æä¸€ä¸ªå¤æ‚æ•°æ®é›†â€¦ï¼ˆæ¨¡æ‹Ÿè€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡ï¼‰"
        )
        if result:
            print(f"\næœ€ç»ˆç»“æœï¼š{result.result}")
    except TaskTimeoutError:
        print("\nâš ï¸  ä»»åŠ¡è¶…æ—¶â€”â€”ä¸é‡è¯•ï¼ˆé¢„æœŸè¡Œä¸ºï¼‰")
    except Exception as e:
        print(f"\nâš ï¸  é”™è¯¯ï¼š{e}")

    # ç¤ºä¾‹ 3ï¼šç®€å•çš„ try/except æ¨¡å¼
    print("\n\nğŸ“ ç¤ºä¾‹ 3ï¼šç®€å•çš„ try/except æ¨¡å¼")
    print("-" * 60)
    client = ShannonClient()
    try:
        handle = client.submit_task(query="æ³•å›½çš„é¦–éƒ½æ˜¯å“ªé‡Œï¼Ÿ")
        result = client.wait(handle.task_id)
        print(f"âœ… æˆåŠŸï¼š{result.result}")
    except ConnectionError:
        print("âŒ ç½‘ç»œé—®é¢˜â€”â€”è¯·æ£€æŸ¥ Shannon æœåŠ¡")
    except TaskTimeoutError:
        print("âŒ ä»»åŠ¡è€—æ—¶è¿‡é•¿")
    except ShannonError as e:
        print(f"âŒ API é”™è¯¯ï¼š{e}")
    except Exception as e:
        print(f"âŒ æœªé¢„æœŸé”™è¯¯ï¼š{e}")

    print("\n" + "=" * 60)
    print("âœ… é”™è¯¯å¤„ç†ç¤ºä¾‹å®Œæˆï¼")
    print("=" * 60)


if __name__ == "__main__":
    main()
```

è¿è¡Œæ–¹æ³•ï¼š

```bash
# ç¡®ä¿ Shannon å·²è¿è¡Œ
make dev

# è¿è¡Œç¤ºä¾‹
python3 error_handling.py
```

ä½•æ—¶ä½¿ç”¨é‡è¯•ï¼š

- ç½‘ç»œä¸ç¨³å®š
- ä¸´æ—¶æ€§æœåŠ¡é—®é¢˜
- å¯¹å¯é æ€§æœ‰è¦æ±‚çš„ç”Ÿäº§ç³»ç»Ÿ

ä¸å»ºè®®é‡è¯•ï¼š

- è¶…æ—¶ï¼ˆä»»åŠ¡æœ¬èº«è¿‡äºå¤æ‚/è€—æ—¶ï¼‰
- API é”™è¯¯ï¼ˆå‚æ•°æ— æ•ˆç­‰ï¼‰
- è®¤è¯å¤±è´¥

## åç»­æ­¥éª¤

<CardGroup cols={2}>
  <Card title="å¼‚æ­¥ç”¨æ³•" icon="bolt" href="/cn/sdk/python/async-usage">
    Async/await æ¨¡å¼
  </Card>
  <Card title="é”™è¯¯å¤„ç†" icon="shield" href="/cn/sdk/python/error-handling">
    æ­£ç¡®å¤„ç†é”™è¯¯
  </Card>
</CardGroup>
