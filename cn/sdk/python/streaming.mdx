---
title: "事件流式传输"
description: "使用 Python SDK 进行实时事件流式传输"
---

<Note>
完整的流式传输文档即将推出。目前请参阅[快速入门指南](/cn/sdk/python/quickstart)了解基本的流式传输示例。
</Note>

## 概述

推荐使用 SSE 获取简单可靠的实时更新。若环境需要 WS，可使用可选的 WebSocket 辅助方法。

## SSE（推荐）

```python
from shannon import ShannonClient, EventType

client = ShannonClient()  # 通过网关 base_url 流式（默认 http://localhost:8080）

handle = client.submit_task(query="分析市场趋势")
for event in client.stream(handle.workflow_id, types=[EventType.LLM_OUTPUT, EventType.WORKFLOW_COMPLETED]):
  print(f"{event.type}: {event.message}")
  if event.type == EventType.WORKFLOW_COMPLETED:
    break

续传：

```python
last_id = None
for e in client.stream(handle.workflow_id, last_event_id=last_id):
  # ...
 last_id = e.id
```

说明：`last_event_id` 可使用 Redis Stream ID（优先，例如 `1700000000000-0`）或数字序号（如 `42`）。SDK 的 `event.id` 会优先返回 `stream_id`，否则回退为 `seq`。
```

## WebSocket（可选）

需要：`pip install websockets`

```python
from shannon import ShannonClient
client = ShannonClient()

h = client.submit_task("通过 WS 流式")
for e in client.stream_ws(h.workflow_id):
  print(e.type, e.message)
  if e.type == "WORKFLOW_COMPLETED":
    break
```
```

## 事件类型

常见事件：
- `WORKFLOW_STARTED` - 开始执行
- `LLM_PROMPT` / `LLM_PARTIAL` / `LLM_OUTPUT` - 模型活动
- `TOOL_INVOKED` / `TOOL_OBSERVATION` - 工具调用
- `APPROVAL_REQUESTED` / `APPROVAL_DECISION` - 人在回路
- `ERROR_OCCURRED` - 错误
- `WORKFLOW_COMPLETED` - 执行完成

<Note>
此处仅列出常见事件。完整事件类型请参考 SDK 的 `EventType` 枚举（例如 `STATUS_UPDATE`、`ROLE_ASSIGNED`、`TEAM_RECRUITED`、`DELEGATION`）。
</Note>

## 异步流式传输

```python
import asyncio
from shannon import AsyncShannonClient

async def stream_task():
    async with AsyncShannonClient() as client:
        handle = await client.submit_task(query="Analyze data")

        async for event in client.stream(handle.workflow_id):
            print(f"Event: {event.type}")
            if event.type == "WORKFLOW_COMPLETED":
                break

asyncio.run(stream_task())
```

## 过滤与续传

按事件类型过滤，并从已知位置续传：

```python
from shannon import EventType

types = [EventType.LLM_OUTPUT, EventType.WORKFLOW_COMPLETED]

last_event_id = None
for event in client.stream(handle.workflow_id, types=types, last_event_id=last_event_id):
    print(event.type)
    last_event_id = event.id
    if event.type == EventType.WORKFLOW_COMPLETED:
        break
```

## 更多示例

更多流式传输示例，请参阅：
- [SDK 快速入门](/cn/sdk/python/quickstart)
- [流式传输概念](/cn/quickstart/concepts/streaming)
- [API 流式传输端点](/cn/api/rest/streaming)

## 下一步

<CardGroup cols={2}>
  <Card title="异步使用" icon="bolt" href="/cn/sdk/python/async-usage">
    异步/等待模式
  </Card>
  <Card title="示例" icon="code" href="/cn/sdk/python/examples">
    更多代码示例
  </Card>
</CardGroup>
