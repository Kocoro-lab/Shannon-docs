---
title: "List Tasks"
description: "GET /api/v1/tasks - List tasks with filtering and pagination"
---

> 🚧 **翻译进行中** - 此文档正在从英文翻译为中文

**原文件**: `api/endpoints/list-tasks.mdx`
**英文版本**: [查看英文文档](/en/api/endpoints/list-tasks)

---


## Endpoint

```
GET /api/v1/tasks
```

Retrieve a list of tasks with optional filtering by status, session, and pagination support. Returns task summaries including execution metadata and token usage.

## Request

### Query Parameters

| Parameter | Type | Required | Description | Valid Values | Default |
|-----------|------|----------|-------------|--------------|---------|
| `limit` | integer | No | Maximum results to return (1-100) | 1-100 | 20 |
| `offset` | integer | No | Pagination offset for results | ≥ 0 | 0 |
| `status` | string | No | Filter by task status | See [Task Statuses](#task-statuses) below | All statuses |
| `session_id` | string | No | Filter by session ID | Valid UUID | All sessions |

**Validation Rules**:
- `limit`: Automatically clamped to range [1, 100]. Values outside this range default to 20
- `offset`: Must be non-negative. Negative values default to 0
- `status`: Case-insensitive. Invalid values return all statuses

### Headers

| Header | Required | Description |
|--------|----------|-------------|
| `X-API-Key` | Conditional | API key for authentication (when `GATEWAY_SKIP_AUTH=0`) |
| `Authorization` | Conditional | Bearer token for JWT authentication |

## Response

### Success Response (200 OK)

```json
{
  "tasks": [
    {
      "task_id": "wf-550e8400-e29b-41d4-a716-446655440000",
      "query": "Analyze Q4 sales trends",
      "status": "TASK_STATUS_COMPLETED",
      "mode": "EXECUTION_MODE_STANDARD",
      "created_at": "2024-10-27T10:00:00Z",
      "completed_at": "2024-10-27T10:02:15Z",
      "total_token_usage": {
        "total_tokens": 5420,
        "prompt_tokens": 3200,
        "completion_tokens": 2220,
        "cost_usd": 0.0814
      }
    },
    {
      "task_id": "wf-660e8400-e29b-41d4-a716-446655440001",
      "query": "Generate product descriptions",
      "status": "TASK_STATUS_RUNNING",
      "mode": "EXECUTION_MODE_SIMPLE",
      "created_at": "2024-10-27T10:05:00Z",
      "completed_at": null,
      "total_token_usage": null
    }
  ],
  "total_count": 42
}
```

### Response Fields

| Field | Type | Description |
|-------|------|-------------|
| `tasks` | array | Array of task summary objects |
| `total_count` | integer | Total number of tasks matching filters (ignores pagination) |

**Task Summary Fields**:

| Field | Type | Description |
|-------|------|-------------|
| `task_id` | string | Unique workflow identifier (UUID format) |
| `query` | string | Original task query text |
| `status` | string | Current task status (see [Task Statuses](#task-statuses)) |
| `mode` | string | Execution mode used (see [Execution Modes](#execution-modes)) |
| `created_at` | timestamp | ISO 8601 timestamp when task was created |
| `completed_at` | timestamp | ISO 8601 timestamp when task completed (null if running/queued) |
| `total_token_usage` | object | Token consumption and cost summary (null if not completed) |

**Token Usage Fields**:

| Field | Type | Description |
|-------|------|-------------|
| `total_tokens` | integer | Sum of prompt + completion tokens |
| `prompt_tokens` | integer | Tokens in input prompts |
| `completion_tokens` | integer | Tokens in model responses |
| `cost_usd` | float | Total cost in USD based on provider pricing |

### Error Responses

#### 401 Unauthorized

```json
{
  "error": "Unauthorized",
  "message": "Missing or invalid authentication credentials"
}
```

**Causes**:
- Missing `X-API-Key` header when authentication is enabled
- Invalid API key
- Expired JWT token

#### 500 Internal Server Error

```json
{
  "error": "Internal server error",
  "message": "Failed to retrieve tasks from orchestrator"
}
```

**Causes**:
- Orchestrator service unavailable
- Database connection failure
- Internal gRPC communication error

## Examples

### List All Tasks (Default Pagination)

```bash
curl http://localhost:8080/api/v1/tasks
```

**Response**:
```json
{
  "tasks": [...],
  "total_count": 42
}
```

### Filter by Status

```bash
# List only running tasks
curl "http://localhost:8080/api/v1/tasks?status=running"

# List completed tasks
curl "http://localhost:8080/api/v1/tasks?status=completed"

# List failed tasks
curl "http://localhost:8080/api/v1/tasks?status=failed"
```

### Filter by Session

```bash
# Get all tasks in a specific session
curl "http://localhost:8080/api/v1/tasks?session_id=sess-123456"
```

### Pagination

```bash
# First page (20 tasks)
curl "http://localhost:8080/api/v1/tasks?limit=20&offset=0"

# Second page
curl "http://localhost:8080/api/v1/tasks?limit=20&offset=20"

# Custom page size
curl "http://localhost:8080/api/v1/tasks?limit=50&offset=0"
```

### Combined Filters

```bash
# Completed tasks in a session, paginated
curl "http://localhost:8080/api/v1/tasks?status=completed&session_id=sess-123&limit=10&offset=0"
```

### With Authentication

```bash
# Using API key
curl -H "X-API-Key: sk_test_123456" \
  "http://localhost:8080/api/v1/tasks?limit=10"

# Using JWT bearer token
curl -H "Authorization: Bearer eyJhbGc..." \
  "http://localhost:8080/api/v1/tasks"
```

### Using Python SDK

<Note>
The Python SDK does not currently provide a `list_tasks()` method. Use the REST API directly or connect via gRPC to the OrchestratorService.
</Note>

```python
import httpx

# Use REST API directly
response = httpx.get(
    "http://localhost:8080/api/v1/tasks",
    params={"limit": 10, "status": "completed"},
    headers={"X-API-Key": "sk_test_123456"}
)

data = response.json()
print(f"Total tasks: {data['total_count']}")

for task in data['tasks']:
    print(f"{task['task_id']}: {task['status']}")
```

### Using JavaScript/TypeScript

```javascript
// Using fetch API
const response = await fetch('http://localhost:8080/api/v1/tasks?limit=10&status=completed', {
  headers: {
    'X-API-Key': 'sk_test_123456'
  }
});

const data = await response.json();
console.log(`Total tasks: ${data.total_count}`);

data.tasks.forEach(task => {
  console.log(`${task.task_id}: ${task.status}`);
  if (task.total_token_usage) {
    console.log(`  Cost: $${task.total_token_usage.cost_usd}`);
  }
});

// Pagination helper
async function getAllTasks(status = null) {
  const allTasks = [];
  let offset = 0;
  const limit = 100;

  while (true) {
    const url = new URL('http://localhost:8080/api/v1/tasks');
    url.searchParams.append('limit', limit);
    url.searchParams.append('offset', offset);
    if (status) url.searchParams.append('status', status);

    const response = await fetch(url);
    const data = await response.json();

    allTasks.push(...data.tasks);

    if (data.tasks.length < limit) break;
    offset += limit;
  }

  return allTasks;
}
```

## Task Statuses

| Status | Description | Typical Duration |
|--------|-------------|------------------|
| `TASK_STATUS_UNSPECIFIED` | Initial state (rare) | < 1 second |
| `TASK_STATUS_QUEUED` | Waiting in execution queue | Seconds to minutes |
| `TASK_STATUS_RUNNING` | Currently executing | Seconds to minutes |
| `TASK_STATUS_COMPLETED` | Successfully finished | N/A (terminal) |
| `TASK_STATUS_FAILED` | Encountered error | N/A (terminal) |
| `TASK_STATUS_CANCELLED` | User-cancelled | N/A (terminal) |
| `TASK_STATUS_TIMEOUT` | Exceeded time limit | N/A (terminal) |

**Status Filtering**:
- Values are **case-insensitive** (`running`, `RUNNING`, `Running` all work)
- Alternative spellings accepted: `CANCELLED` or `CANCELED`
- Invalid status values return tasks with **any status**

## Execution Modes

Tasks run in different execution modes that affect complexity and cost:

| Mode | Description | Use Case |
|------|-------------|----------|
| `EXECUTION_MODE_SIMPLE` | Single LLM call, no tools | Simple Q&A, text generation |
| `EXECUTION_MODE_STANDARD` | Multi-step with tools | Research, analysis, data processing |
| `EXECUTION_MODE_COMPLEX` | Complex patterns (CoT, ToT) | Multi-agent reasoning, debate |

## Cost Tracking

The `total_token_usage` field provides cost visibility:

```json
{
  "total_token_usage": {
    "total_tokens": 5420,      // Sum of prompt + completion
    "prompt_tokens": 3200,      // Input tokens
    "completion_tokens": 2220,  // Output tokens
    "cost_usd": 0.0814         // Actual cost based on provider pricing
  }
}
```

**Cost Calculation**:
- Costs vary by LLM provider (OpenAI, Anthropic, etc.)
- Pricing is per-token and model-specific
- Includes all iterations and tool calls
- Updated in real-time as task progresses

## Pagination Best Practices

**For small datasets** (< 100 tasks):
```bash
curl "http://localhost:8080/api/v1/tasks?limit=100"
```

**For large datasets** (efficient iteration):
```python
import httpx

def fetch_all_tasks(api_key, status=None, session_id=None):
    """Fetch all tasks with pagination using REST API."""
    all_tasks = []
    offset = 0
    limit = 100  # Maximum allowed

    while True:
        params = {"limit": limit, "offset": offset}
        if status:
            params["status"] = status
        if session_id:
            params["session_id"] = session_id

        response = httpx.get(
            "http://localhost:8080/api/v1/tasks",
            params=params,
            headers={"X-API-Key": api_key}
        )
        result = response.json()

        all_tasks.extend(result['tasks'])

        # Stop if we got fewer tasks than requested
        if len(result['tasks']) < limit:
            break

        offset += limit

    return all_tasks
```

**Displaying total count**:
```python
import httpx

response = httpx.get(
    "http://localhost:8080/api/v1/tasks",
    params={"limit": 10},
    headers={"X-API-Key": "sk_test_123456"}
)
result = response.json()
print(f"Showing {len(result['tasks'])} of {result['total_count']} tasks")
```

## Performance Considerations

- **Database indexed fields**: `user_id`, `session_id`, `status`, `created_at`
- **Typical response time**: 50-200ms for moderate result sets
- **Maximum recommended `limit`**: 100 (automatically enforced)
- **Sorting**: Results ordered by `created_at DESC` (newest first)

## Related Endpoints

<CardGroup cols={2}>
  <Card title="Submit Task" icon="plus" href="/cn/api/endpoints/submit-task">
    Create new tasks
  </Card>
  <Card title="Get Task Status" icon="info" href="/cn/api/endpoints/get-task-status">
    Get detailed task information
  </Card>
  <Card title="Cancel Task" icon="xmark" href="/cn/api/endpoints/cancel-task">
    Cancel running tasks
  </Card>
  <Card title="Sessions" icon="comments" href="/cn/api/endpoints/sessions">
    Session management
  </Card>
</CardGroup>


---

## 参与翻译

如果您想帮助翻译此文档，请访问我们的 [GitHub 仓库](https://github.com/Kocoro-lab/Shannon)。
