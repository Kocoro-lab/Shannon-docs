---
title: "提交任务"
description: "POST /api/v1/tasks - 提交任务供智能体执行"
---

## 端点

```
POST /api/v1/tasks
```

向 Shannon 提交新任务供 AI 智能体执行。任务将被执行和监控；高级配置（预算、模式）由内部处理，尚未通过 REST 公开。

## 请求

### 请求头

| 请求头 | 必需 | 描述 |
|--------|----------|-------------|
| `Content-Type` | 是 | `application/json` |
| `X-API-Key` | 条件性 | API 密钥（启用认证时） |
| `Idempotency-Key` | 否 | 用于防止重复执行的唯一密钥 |

### 请求体参数

| 参数 | 类型 | 必需 | 描述 |
|-----------|------|----------|-------------|
| `query` | string | 是 | 任务描述或问题 |
| `session_id` | string | 否 | 多轮对话的会话 ID（省略时自动生成） |
| `context` | object | 否 | 额外的上下文数据 |

<Note>
预算限制、显式模式和认知策略选择由平台管理。这些控件还不能通过 REST 请求体进行配置。
</Note>

## 响应

### 成功 (200 OK)

```json
{
  "task_id": "task-dev-1730000000",
  "status": "TASK_STATUS_RUNNING",
  "message": "任务已提交",
  "created_at": "2024-10-22T10:30:00Z"
}

响应头包括：
- `X-Workflow-ID`: 与任务关联的工作流 ID
- `X-Session-ID`: 用于任务的会话 ID
```

### 错误响应

| 状态码 | 错误代码 | 描述 |
|--------|------------|-------------|
| 400 | `INVALID_REQUEST` | 缺少或无效的参数 |
| 401 | `UNAUTHORIZED` | 无效或缺少 API 密钥 |
| 429 | `RATE_LIMIT_EXCEEDED` | 请求过多 |
| 500 | `INTERNAL_ERROR` | 服务器错误 |

## 示例

### 简单查询

<CodeGroup>

```bash cURL
curl -X POST http://localhost:8080/api/v1/tasks \
  -H "Content-Type: application/json" \
  -d '{
    "query": "法国的首都是什么？"
  }'
```

```python Python SDK
from shannon import ShannonClient

# 使用 gRPC 提交，SSE 默认使用管理端口 8081
client = ShannonClient()  # grpc: localhost:50052, http: http://localhost:8081

handle = client.submit_task(query="法国的首都是什么？")
print("任务 ID:", handle.task_id)
```

```javascript JavaScript (fetch)
const response = await fetch('http://localhost:8080/api/v1/tasks', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    query: '法国的首都是什么？'
  })
});

const data = await response.json();
console.log('任务 ID:', data.task_id);
```

</CodeGroup>

### 幂等性

<CodeGroup>

```bash cURL
curl -X POST http://localhost:8080/api/v1/tasks \
  -H "Idempotency-Key: unique-id-12345" \
  -H "Content-Type: application/json" \
  -d '{"query": "处理支付"}'
```

```python Python SDK
handle = client.submit_task(query="处理支付")
```

</CodeGroup>

### 多轮对话

<CodeGroup>

```bash cURL
# 第一条消息
curl -X POST http://localhost:8080/api/v1/tasks \
  -H "Content-Type: application/json" \
  -d '{
    "query": "什么是 Python？",
    "session_id": "user-123-conv"
  }'

# 后续消息（Shannon 记住上下文）
curl -X POST http://localhost:8080/api/v1/tasks \
  -H "Content-Type: application/json" \
  -d '{
    "query": "它的主要用例是什么？",
    "session_id": "user-123-conv"
  }'
```

```python Python SDK
session_id = "user-123-conv"

handle1 = client.submit_task(query="什么是 Python？", session_id=session_id)
handle2 = client.submit_task(query="它的主要用例是什么？", session_id=session_id)
```

</CodeGroup>

### 带自定义上下文的复杂任务

<Note>
执行模式和认知策略等高级配置不通过 REST API 请求体参数公开。平台根据查询复杂度智能选择适当的执行策略。
</Note>

<CodeGroup>

```bash cURL
curl -X POST http://localhost:8080/api/v1/tasks \
  -H "Content-Type: application/json" \
  -d '{
    "query": "比较微服务与单体架构并提供详细的优缺点",
    "context": {
      "domain": "software_architecture",
      "detail_level": "comprehensive"
    }
  }'
```

```python Python SDK
# Python SDK 通过 gRPC 支持额外参数
handle = client.submit_task(
    query="比较微服务与单体架构",
    context={
        "domain": "software_architecture",
        "detail_level": "comprehensive"
    }
)
```

</CodeGroup>

### 使用自定义上下文

<CodeGroup>

```bash cURL
curl -X POST http://localhost:8080/api/v1/tasks \
  -H "Content-Type: application/json" \
  -d '{
    "query": "为我的应用程序推荐数据库",
    "context": {
      "application_type": "e-commerce",
      "expected_traffic": "10k requests/sec",
      "data_size": "100TB"
    }
  }'
```

```python Python SDK
handle = client.submit_task(
    query="为我的应用程序推荐数据库",
    context={
        "application_type": "e-commerce",
        "expected_traffic": "10k requests/sec",
        "data_size": "100TB"
    }
)
```

</CodeGroup>

### 使用幂等性

```bash
# 第一次请求
curl -X POST http://localhost:8080/api/v1/tasks \
  -H "Idempotency-Key: unique-id-12345" \
  -H "Content-Type: application/json" \
  -d '{"query": "处理支付"}'

# 重复请求（返回相同结果，不重新执行）
curl -X POST http://localhost:8080/api/v1/tasks \
  -H "Idempotency-Key: unique-id-12345" \
  -H "Content-Type: application/json" \
  -d '{"query": "处理支付"}'
```

## 执行模式

### 说明

执行模式（Simple/Standard/Complex）在内部选择。REST API 目前不接受 `mode` 参数。

## 认知策略

Shannon 在内部选择适当的策略（例如，直接执行、分解、ReAct）。通过 REST 手动选择将在可用时记录在文档中。

## 响应字段

| 字段 | 类型 | 描述 |
|-------|------|-------------|
| `task_id` | string | 唯一任务标识符 |
| `status` | string | `TASK_STATUS_*`（例如，`TASK_STATUS_RUNNING`） |
| `created_at` | timestamp | 任务创建时间 |

## 最佳实践

### 1. 对重试使用幂等性

### 2. 使用会话保持上下文

```python
session_id = f"user-{user.id}-{conversation.id}"
```

### 3. 提供丰富的上下文

```python
handle = client.submit_task(
    query="分析销售趋势",
    context={
        "time_period": "Q4 2024",
        "region": "North America",
        "metrics": ["revenue", "customer_count"]
    }
)
```

### 2. 监控任务进度

```python
# 提交任务
handle = client.submit_task(query="...")

# 流式传输事件
for event in client.stream(handle.workflow_id):
    print(f"{event.type}: {event.message}")
```

## 下一步

<CardGroup cols={2}>
  <Card title="获取任务状态" icon="magnifying-glass" href="/cn/api/endpoints/get-task-status">
    检查任务执行状态
  </Card>
  <Card title="流式传输事件" icon="stream" href="/cn/api/endpoints/stream-task">
    实时监控任务
  </Card>
  <Card title="Python SDK" icon="python" href="/cn/sdk/python/quickstart">
    使用 SDK 以便于集成
  </Card>
</CardGroup>
