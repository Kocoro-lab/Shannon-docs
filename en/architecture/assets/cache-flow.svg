<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 520">
  <defs>
    <style>
      .label { font: 500 10px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #666; text-anchor: middle; letter-spacing: 0.5px; }
      .box-text { font: 600 13px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #1a1a1a; text-anchor: middle; }
      .box-text-sm { font: 600 11px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #1a1a1a; text-anchor: middle; }
      .title { font: 700 16px 'SF Mono', 'PingFang SC', sans-serif; fill: #1a1a1a; text-anchor: middle; }
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>

  <rect width="700" height="520" fill="#fff"/>
  <text x="350" y="30" class="title">LLM Response Caching</text>

  <!-- Completion Request -->
  <rect x="270" y="60" width="160" height="50" fill="#fef3c7" stroke="#1a1a1a" stroke-width="1.5" rx="2"/>
  <text x="350" y="88" class="box-text">Completion Request</text>

  <line x1="350" y1="110" x2="350" y2="135" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- Generate Cache Key -->
  <rect x="270" y="140" width="160" height="50" fill="#dbeafe" stroke="#1a1a1a" stroke-width="1.5" rx="2"/>
  <text x="350" y="163" class="box-text-sm">Generate Cache Key</text>
  <text x="350" y="178" class="label">SHA-256 hash</text>

  <line x1="350" y1="190" x2="350" y2="215" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- Cache Hit Decision -->
  <path d="M 350 220 L 410 260 L 350 300 L 290 260 Z" fill="#a5f3fc" stroke="#1a1a1a" stroke-width="1.5"/>
  <text x="350" y="263" class="box-text-sm">Cache Hit?</text>

  <!-- Yes path -->
  <line x1="410" y1="260" x2="520" y2="260" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="465" y="255" class="label">Yes</text>

  <rect x="525" y="235" width="140" height="50" fill="#d1fae5" stroke="#1a1a1a" stroke-width="1.5" rx="2"/>
  <text x="595" y="253" class="box-text-sm">Return Cached</text>
  <text x="595" y="268" class="box-text-sm">Response</text>

  <!-- No path -->
  <line x1="290" y1="260" x2="180" y2="260" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="235" y="255" class="label">No</text>

  <rect x="80" y="235" width="100" height="50" fill="#fde047" stroke="#1a1a1a" stroke-width="1.5" rx="2"/>
  <text x="130" y="263" class="box-text-sm">LLM Provider</text>

  <line x1="130" y1="285" x2="130" y2="325" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- Validate Response -->
  <path d="M 130 330 L 190 370 L 130 410 L 70 370 Z" fill="#a5f3fc" stroke="#1a1a1a" stroke-width="1.5"/>
  <text x="130" y="370" class="box-text-sm">Valid</text>
  <text x="130" y="383" class="box-text-sm">Response?</text>

  <!-- Yes - Store -->
  <line x1="190" y1="370" x2="265" y2="370" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="227" y="365" class="label">Yes</text>

  <rect x="270" y="345" width="120" height="50" fill="#99f6e4" stroke="#1a1a1a" stroke-width="1.5" rx="2"/>
  <text x="330" y="373" class="box-text-sm">Store in Cache</text>

  <line x1="390" y1="370" x2="445" y2="370" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- No - Skip -->
  <line x1="130" y1="410" x2="130" y2="450" stroke="#666" stroke-width="1.5"/>
  <line x1="130" y1="450" x2="490" y2="450" stroke="#666" stroke-width="1.5"/>
  <line x1="490" y1="450" x2="490" y2="395" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="310" y="465" class="label">No - Skip Caching</text>

  <!-- Return Response -->
  <rect x="450" y="345" width="120" height="50" fill="#e5e7eb" stroke="#1a1a1a" stroke-width="1.5" rx="2"/>
  <text x="510" y="373" class="box-text-sm">Return Response</text>

  <!-- Cache Backends -->
  <rect x="60" y="60" width="120" height="40" fill="#fbcfe8" stroke="#1a1a1a" stroke-width="1.5" rx="2"/>
  <text x="120" y="85" class="box-text-sm">In-Memory LRU</text>

  <rect x="520" y="60" width="100" height="40" fill="#fca5a5" stroke="#1a1a1a" stroke-width="1.5" rx="2"/>
  <text x="570" y="85" class="box-text-sm">Redis</text>

  <!-- Check connections -->
  <line x1="180" y1="85" x2="265" y2="85" stroke="#666" stroke-width="1.5" stroke-dasharray="4"/>
  <line x1="265" y1="85" x2="265" y2="260" stroke="#666" stroke-width="1.5" stroke-dasharray="4"/>
  <line x1="265" y1="260" x2="285" y2="260" stroke="#666" stroke-width="1.5" stroke-dasharray="4" marker-end="url(#arrow)"/>

  <line x1="520" y1="85" x2="435" y2="85" stroke="#666" stroke-width="1.5" stroke-dasharray="4"/>
  <line x1="435" y1="85" x2="435" y2="260" stroke="#666" stroke-width="1.5" stroke-dasharray="4"/>
  <line x1="435" y1="260" x2="415" y2="260" stroke="#666" stroke-width="1.5" stroke-dasharray="4" marker-end="url(#arrow)"/>

  <!-- Store connections -->
  <line x1="290" y1="370" x2="290" y2="430" stroke="#666" stroke-width="1.5" stroke-dasharray="4"/>
  <line x1="290" y1="430" x2="120" y2="430" stroke="#666" stroke-width="1.5" stroke-dasharray="4"/>
  <line x1="120" y1="430" x2="120" y2="105" stroke="#666" stroke-width="1.5" stroke-dasharray="4" marker-end="url(#arrow)"/>

  <line x1="370" y1="370" x2="370" y2="480" stroke="#666" stroke-width="1.5" stroke-dasharray="4"/>
  <line x1="370" y1="480" x2="570" y2="480" stroke="#666" stroke-width="1.5" stroke-dasharray="4"/>
  <line x1="570" y1="480" x2="570" y2="105" stroke="#666" stroke-width="1.5" stroke-dasharray="4" marker-end="url(#arrow)"/>
</svg>
